import{o as e,c as t,w as l,e as r,F as a,r as o,n,a as s,d as i,p as u,t as d,z as c,i as p,u as g,h as m,j as h,l as b,G as f,s as y,x as v,J as _,D as w,L as x,M as C,N as I,O as L}from"./index-CoyfKnWG.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as $}from"./uni-app.es.Df7zo4VE.js";import{_ as k,a as T,b as M}from"./uni-forms.CwM7OQSX.js";import{a as N,b as q,r as P,g as U}from"./user.OcbLy9Nv.js";import{C as j,U as F,L as A}from"./cache.CRrot_FV.js";import"./uni-icons.D0E4Jxnq.js";import"./request.BIpDWIEA.js";const S=V({name:"UniSegmentedControl",emits:["clickItem"],props:{current:{type:Number,default:0},values:{type:Array,default:()=>[]},activeColor:{type:String,default:"#2979FF"},inActiveColor:{type:String,default:"transparent"},styleType:{type:String,default:"button"}},data:()=>({currentIndex:0}),watch:{current(e){e!==this.currentIndex&&(this.currentIndex=e)}},computed:{},created(){this.currentIndex=this.current},methods:{_onClick(e){this.currentIndex!==e&&(this.currentIndex=e,this.$emit("clickItem",{currentIndex:e}))}}},[["render",function(g,m,h,b,f,y){const v=c,_=p;return e(),t(_,{class:n([["text"===h.styleType?"segmented-control--text":"segmented-control--button"],"segmented-control"]),style:s({borderColor:"text"===h.styleType?"":h.activeColor})},{default:l((()=>[(e(!0),r(a,null,o(h.values,((r,a)=>(e(),t(_,{class:n([["text"===h.styleType?"":"segmented-control__item--button",0===a&&"button"===h.styleType?"segmented-control__item--button--first":"",a===h.values.length-1&&"button"===h.styleType?"segmented-control__item--button--last":""],"segmented-control__item"]),key:a,style:s({backgroundColor:a===f.currentIndex&&"button"===h.styleType?h.activeColor:"button"===h.styleType?h.inActiveColor:"transparent",borderColor:a===f.currentIndex&&"text"===h.styleType||"button"===h.styleType?h.activeColor:h.inActiveColor}),onClick:e=>y._onClick(a)},{default:l((()=>[i(_,null,{default:l((()=>[i(v,{style:s({color:a===f.currentIndex?"text"===h.styleType?h.activeColor:"#fff":"text"===h.styleType?"#000":h.activeColor}),class:n(["segmented-control__text","text"===h.styleType&&a===f.currentIndex?"segmented-control__item--text":""])},{default:l((()=>[u(d(r),1)])),_:2},1032,["style","class"])])),_:2},1024)])),_:2},1032,["class","style","onClick"])))),128))])),_:1},8,["class","style"])}],["__scopeId","data-v-754001e5"]]);const z=V({components:{loginPage:V({__name:"login",setup(r){const{t:a}=g(),o=m(null),n=m({phoneNumber:"",password:"",captcha:"",captchaId:""}),s=m({id:"",image:""}),w=m({phoneNumber:{rules:[{required:!0,errorMessage:a("login.phone.input")},{minLength:10,maxLength:10,errorMessage:a("login.phone.length.error")}]},password:{rules:[{required:!0,errorMessage:a("login.password.input")},{minLength:6,maxLength:16,errorMessage:a("login.password.length.error")}]},captcha:{rules:[{required:!0,errorMessage:a("login.verification.input")},{minLength:5,maxLength:5,errorMessage:a("login.verification.error")}]}}),x=async()=>{const e=await N();s.value.image=e.data.imgPath,s.value.id=e.data.captchaId},C=async()=>{try{const e=await o.value.validate();console.log("表单数据信息：",e);const t={phoneNumber:"+7"+n.value.phoneNumber,captchaId:s.value.id,captcha:n.value.captcha,password:n.value.password},l=await q(t);0===l.code?(j.set(F,l.data,l.data.expire),j.set(A,l.data.token,l.data.expire),f({title:a("login.login.success"),icon:"none",duration:2e3}),setTimeout((()=>{y({url:"/pages/home/index",animationType:"none"})}),1e3)):3===l.code&&(x(),f({title:a("login.login.error"),icon:"none",duration:3e3}))}catch(e){console.log("表单错误信息：",e)}};return h((()=>{x(),console.log("getCaptchaApi has been called")})),(r,a)=>{const g=c,m=$(b("uni-easyinput"),k),h=$(b("uni-forms-item"),T),f=v,y=$(b("uni-forms"),M),I=_,L=p;return e(),t(L,{class:"loginContent"},{default:l((()=>[i(y,{ref_key:"valiForm",ref:o,rules:w.value,modelValue:n.value,"label-position":"top","label-width":"70"},{default:l((()=>[i(h,{required:"",label:r.$t("login.phone.number"),name:"phoneNumber"},{default:l((()=>[i(m,{type:"number",modelValue:n.value.phoneNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value.phoneNumber=e),placeholder:r.$t("login.phone.input")},{left:l((()=>[i(g,{style:{"margin-left":"10rpx"}},{default:l((()=>[u("+7")])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),i(h,{required:"",label:r.$t("login.password"),name:"password"},{default:l((()=>[i(m,{type:"password",modelValue:n.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value.password=e),placeholder:r.$t("login.password.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(h,{required:"",label:r.$t("login.verification.code"),name:"captcha"},{default:l((()=>[i(m,{type:"text",modelValue:n.value.captcha,"onUpdate:modelValue":a[2]||(a[2]=e=>n.value.captcha=e),placeholder:r.$t("login.verification.input")},{left:l((()=>[i(f,{onClick:x,style:{width:"160rpx",height:"60rpx"},src:s.value.image,mode:""},null,8,["src"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["rules","modelValue"]),i(I,{type:"default",style:{color:"#e4e4e4","background-color":"#3b3029"},onClick:C},{default:l((()=>[u(d(r.$t("login.login")),1)])),_:1})])),_:1})}}},[["__scopeId","data-v-c0b22a25"]]),registerPage:V({__name:"register",props:{switchToLogin:Function},setup(r){const a=r,o=m(null),n=w({username:"",phoneNumber:"",password:"",rePassword:"",captcha:""}),s=m(!1),g=m(60),h=w({username:{rules:[{required:!0,errorMessage:x.global.t("register.username.input")}]},phoneNumber:{rules:[{required:!0,errorMessage:x.global.t("login.phone.input")},{minLength:10,maxLength:10,errorMessage:x.global.t("login.phone.length.error")}]},password:{rules:[{required:!0,errorMessage:x.global.t("login.password.input")},{minLength:6,maxLength:16,errorMessage:x.global.t("login.password.length.error")}]},rePassword:{rules:[{required:!0,errorMessage:x.global.t("login.password.input")},{minLength:6,maxLength:16,errorMessage:x.global.t("login.password.length.error")},{validateFunction:(e,t,l)=>t===n.password||x.global.t("register.passwordMismatch")}]},captcha:{rules:[{required:!0,errorMessage:x.global.t("login.verification.input")},{minLength:5,maxLength:5,errorMessage:x.global.t("login.verification.error")}]}}),y=async()=>{const e=h.phoneNumber.rules,t=n.phoneNumber;if(!e.every((e=>e.required&&!t||e.minLength&&t.length<e.minLength?(f({title:e.errorMessage,icon:"none",duration:2e3}),!1):!(e.maxLength&&t.length>e.maxLength)||(f({title:e.errorMessage,icon:"none",duration:2e3}),!1)))||s.value)return;const l={phoneNumber:"+7"+t};if(0===(await U(l)).code){f({title:x.global.t("register.codeSent"),icon:"none",duration:1e3}),console.log("发送验证码..."),s.value=!0;const e=setInterval((()=>{g.value-=1,g.value<=0&&(clearInterval(e),s.value=!1,g.value=60)}),1e3)}};return(r,m)=>{const v=$(b("uni-easyinput"),k),w=$(b("uni-forms-item"),T),C=c,I=_,L=$(b("uni-forms"),M),V=p;return e(),t(V,{class:"loginContent"},{default:l((()=>[i(L,{ref_key:"valiForm",ref:o,rules:h,"model-value":n,"label-position":"top","label-width":"70"},{default:l((()=>[i(w,{required:"",label:r.$t("register.username"),name:"username"},{default:l((()=>[i(v,{type:"text",modelValue:n.username,"onUpdate:modelValue":m[0]||(m[0]=e=>n.username=e),placeholder:r.$t("register.username.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(w,{required:"",label:r.$t("login.phone.number"),name:"phoneNumber"},{default:l((()=>[i(v,{type:"number",modelValue:n.phoneNumber,"onUpdate:modelValue":m[1]||(m[1]=e=>n.phoneNumber=e),placeholder:r.$t("login.phone.input")},{left:l((()=>[i(C,{style:{"margin-left":"10rpx"}},{default:l((()=>[u("+7")])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),i(w,{required:"",label:r.$t("login.password"),name:"password"},{default:l((()=>[i(v,{type:"password",modelValue:n.password,"onUpdate:modelValue":m[2]||(m[2]=e=>n.password=e),placeholder:r.$t("login.password.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(w,{required:"",label:r.$t("register.confirmPassword"),name:"rePassword"},{default:l((()=>[i(v,{type:"password",modelValue:n.rePassword,"onUpdate:modelValue":m[3]||(m[3]=e=>n.rePassword=e),placeholder:r.$t("login.password.input")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(w,{required:"",label:r.$t("login.verification.code"),name:"captcha"},{default:l((()=>[i(v,{type:"text",modelValue:n.captcha,"onUpdate:modelValue":m[4]||(m[4]=e=>n.captcha=e),placeholder:r.$t("login.verification.input")},{right:l((()=>[i(I,{loading:s.value,size:"mini",disabled:s.value,onClick:y,style:{margin:"auto",padding:"0 20rpx","background-color":"#3b3029",color:"#e4e4e4"}},{default:l((()=>[u(d(s.value?`${g.value}s`:r.$t("register.sendCode")),1)])),_:1},8,["loading","disabled"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["rules","model-value"]),i(I,{type:"default",style:{color:"#e4e4e4",backgroundColor:"#3b3029"},onClick:m[5]||(m[5]=e=>(async()=>{try{await o.value.validate();const e={...n,phoneNumber:"+7"+n.phoneNumber},t=await P(e);0===t.code?(console.log(t),f({title:x.global.t("register.success"),icon:"none",duration:2e3}),a.switchToLogin()):3===t.code&&f({title:x.global.t("register.codeError"),icon:"none",duration:3e3})}catch(e){console.log("表单错误信息：",e)}})())},{default:l((()=>[u(d(r.$t("register.register")),1)])),_:1})])),_:1})}}},[["__scopeId","data-v-c179831e"]])},data(){return{items:[this.$t("login.login"),this.$t("login.register")],current:0}},methods:{onClickItem(e){this.current!=e.currentIndex&&(this.current=e.currentIndex)},switchToLogin(){this.current=0}}},[["render",function(r,a,o,n,s,u){const d=$(b("uni-segmented-control"),S),c=p,g=C("loginPage"),m=C("registerPage");return e(),t(c,null,{default:l((()=>[i(c,{class:"segment"},{default:l((()=>[i(d,{current:s.current,values:s.items,onClickItem:u.onClickItem,styleType:"button",activeColor:"#3b3029"},null,8,["current","values","onClickItem"])])),_:1}),i(c,{class:"content"},{default:l((()=>[I(i(c,null,{default:l((()=>[i(g)])),_:1},512),[[L,0===s.current]]),I(i(c,null,{default:l((()=>[i(m,{switchToLogin:u.switchToLogin},null,8,["switchToLogin"])])),_:1},512),[[L,1===s.current]])])),_:1})])),_:1})}],["__scopeId","data-v-55823fb0"]]);export{z as default};
