import{u as e,h as a,D as s,j as n,l as t,o,c as i,w as r,i as l,d as c,p as u,t as d,q as m,n as f,b as p,G as k,R as h,z as _,J as b}from"./index-CoyfKnWG.js";import{_ as v,a as g,b as F}from"./uni-forms.CwM7OQSX.js";import{r as j}from"./uni-app.es.Df7zo4VE.js";import{_ as y}from"./uni-icons.D0E4Jxnq.js";import{C as x,U as N}from"./cache.CRrot_FV.js";import{d as C,m as V}from"./user.OcbLy9Nv.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.BIpDWIEA.js";const I=q({__name:"editProfile",setup(q){const{t:I}=e(),L=a(null),w=s({nickname:""}),z=a(""),M=a(!1),R={nickname:{rules:[{required:!0,errorMessage:I("user.enterNickName")},{minLength:2,maxLength:20,errorMessage:I("user.nickNameLengthError")}]}},T=()=>{if(!M.value)return w.nickname===z.value?(k({title:I("user.noChanges"),icon:"none",duration:2e3}),void setTimeout((()=>{U()}),1e3)):void L.value.validate().then((()=>{M.value=!0,V(w).then((e=>{if(0===e.code){const e=x.get(N);e.nickname=w.nickname,x.set(N,e),k({title:I("user.editSuccess"),icon:"success",duration:2e3}),setTimeout((()=>{h()}),1500)}else k({title:e.msg||I("user.editFailed"),icon:"error",duration:2e3})})).catch((e=>{console.error("修改失败:",e),k({title:I("user.editFailed"),icon:"error",duration:2e3})})).finally((()=>{M.value=!1}))})).catch((e=>{console.log("表单错误信息：",e)}))},U=()=>{h()};return n((()=>{(()=>{const e={id:x.get(N).userId};C(e).then((e=>{if(0===e.code){w.nickname=e.data.nickname,z.value=e.data.nickname;const a=x.get(N);a.nickname=e.data.nickname,x.set(N,a)}}))})()})),(e,a)=>{const s=_,n=l,k=j(t("uni-easyinput"),v),h=j(t("uni-forms-item"),g),x=j(t("uni-forms"),F),N=b,C=j(t("uni-icons"),y);return o(),i(n,{class:"edit-nickname-container"},{default:r((()=>[c(n,{class:"page-header"},{default:r((()=>[c(s,{class:"page-title"},{default:r((()=>[u(d(m(I)("user.editInformation")),1)])),_:1})])),_:1}),c(n,{class:"form-container"},{default:r((()=>[c(x,{ref_key:"valiForm",ref:L,rules:R,modelValue:w,"label-position":"top","label-width":200},{default:r((()=>[c(h,{required:"",label:m(I)("user.nickName"),name:"nickname"},{default:r((()=>[c(k,{type:"text",modelValue:w.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>w.nickname=e),placeholder:m(I)("user.enterNickName"),styles:{borderRadius:"12rpx",backgroundColor:"#F8F8F8"},class:"nickname-input",prefixIcon:"person-filled",trim:"all",maxlength:"20",focus:!0},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),c(n,{class:"button-group"},{default:r((()=>[c(N,{class:"cancel-button","hover-class":"button-hover",onClick:U},{default:r((()=>[u(d(m(I)("uni.picker.cancel")),1)])),_:1}),c(N,{class:f(["confirm-button",{"button-disabled":!w.nickname||M.value}]),disabled:!w.nickname||M.value,"hover-class":"button-hover",onClick:T},{default:r((()=>[c(n,{class:"button-content"},{default:r((()=>[M.value?(o(),i(C,{key:0,type:"spinner-cycle",size:"18",color:"#FFFFFF"})):p("",!0),c(s,null,{default:r((()=>[u(d(m(I)("user.confirm")),1)])),_:1})])),_:1})])),_:1},8,["disabled","class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-cbe9c40f"]]);export{I as default};
