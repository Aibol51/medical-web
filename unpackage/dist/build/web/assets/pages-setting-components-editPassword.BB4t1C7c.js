import{u as e,h as a,D as r,k as s,j as o,l,o as t,c as n,w as u,i as d,d as i,p as c,t as p,q as m,a as h,b as g,n as b,G as f,R as v,z as w,J as _}from"./index-CoyfKnWG.js";import{_ as F,a as y,b as x}from"./uni-forms.CwM7OQSX.js";import{r as V}from"./uni-app.es.Df7zo4VE.js";import{_ as k}from"./uni-icons.D0E4Jxnq.js";import{C as M,U as L}from"./cache.CRrot_FV.js";import{d as N,g as q,e as P}from"./user.OcbLy9Nv.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.BIpDWIEA.js";const j=C({__name:"editPassword",setup(C){const{t:j}=e(),R=a(null),S=r({phoneNumber:"",password:"",rePassword:"",captcha:""}),U=a(!1),z=a(60),A=a(!1),B=a(!1),I=a(!1),W=s((()=>{const e=S.password;if(!e)return 0;let a=0;return e.length>=8&&(a+=1),/\d/.test(e)&&(a+=1),/[a-z]/.test(e)&&(a+=1),/[A-Z]/.test(e)&&(a+=1),/[^A-Za-z0-9]/.test(e)&&(a+=1),Math.min(4,a)})),Z=s((()=>{const e=W.value;return j(0===e||1===e?"user.passwordWeak":2===e?"user.passwordMedium":3===e?"user.passwordStrong":"user.passwordVeryStrong")})),D=s((()=>{const e=W.value;return 0===e||1===e?"#FF5252":2===e?"#FFB300":3===e?"#66BB6A":"#43A047"})),E=s((()=>S.phoneNumber&&S.password&&S.rePassword&&S.captcha&&S.password===S.rePassword)),G={phoneNumber:{rules:[{required:!0,errorMessage:j("login.phone.input")},{minLength:10,maxLength:10,errorMessage:j("login.phone.length.error")}]},password:{rules:[{required:!0,errorMessage:j("login.password.input")},{minLength:6,maxLength:16,errorMessage:j("login.password.length.error")}]},rePassword:{rules:[{required:!0,errorMessage:j("login.password.input")},{minLength:6,maxLength:16,errorMessage:j("login.password.length.error")},{validateFunction:(e,a,r)=>a===S.password||j("register.passwordMismatch")}]},captcha:{rules:[{required:!0,errorMessage:j("login.verification.input")},{minLength:5,maxLength:5,errorMessage:j("login.verification.error")}]}},J=()=>{const e=G.phoneNumber.rules,a=S.phoneNumber;if(!e.every((e=>e.required&&!a||e.minLength&&a.length<e.minLength?(f({title:e.errorMessage,icon:"none",duration:2e3}),!1):!(e.maxLength&&a.length>e.maxLength)||(f({title:e.errorMessage,icon:"none",duration:2e3}),!1))))return;if(U.value)return;q({phoneNumber:"+7"+a}).then((e=>{if(0===e.code){f({title:j("register.codeSent"),icon:"success",duration:2e3}),U.value=!0;let e=setInterval((()=>{z.value-=1,z.value<=0&&(clearInterval(e),U.value=!1,z.value=60)}),1e3)}}))},T=()=>{A.value||R.value.validate().then((()=>{A.value=!0;const e={...S,phoneNumber:"+7"+S.phoneNumber};P(e).then((e=>{0===e.code?(f({title:j("user.editPasswordSuccess"),icon:"success",duration:2e3}),setTimeout((()=>{v()}),1500)):3===e.code?f({title:j("register.codeError"),icon:"error",duration:3e3}):f({title:e.msg||j("user.editFailed"),icon:"error",duration:2e3})})).catch((e=>{console.error("修改失败:",e),f({title:j("user.editFailed"),icon:"error",duration:2e3})})).finally((()=>{A.value=!1}))})).catch((e=>{console.log("表单错误信息：",e)}))},$=()=>{v()};return o((()=>{(()=>{const e={id:M.get(L).userId};N(e).then((e=>{if(0===e.code){let a=e.data.mobile;a.startsWith("+7")&&(a=a.replace("+7","")),S.phoneNumber=a}}))})()})),(e,a)=>{const r=w,s=d,o=V(l("uni-easyinput"),F),f=V(l("uni-forms-item"),y),v=_,M=V(l("uni-forms"),x),L=V(l("uni-icons"),k);return t(),n(s,{class:"edit-password-container"},{default:u((()=>[i(s,{class:"page-header"},{default:u((()=>[i(r,{class:"page-title"},{default:u((()=>[c(p(m(j)("user.editPassword")),1)])),_:1})])),_:1}),i(s,{class:"form-container"},{default:u((()=>[i(M,{ref_key:"valiForm",ref:R,rules:G,modelValue:S,"label-position":"top","label-width":200},{default:u((()=>[i(f,{required:"",label:m(j)("login.phone.number"),name:"phoneNumber"},{default:u((()=>[i(o,{type:"number",modelValue:S.phoneNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>S.phoneNumber=e),placeholder:m(j)("login.phone.input"),disabled:!0,styles:{borderRadius:"12rpx",backgroundColor:"#F8F8F8"},class:"input-field"},{left:u((()=>[i(s,{class:"phone-prefix"},{default:u((()=>[i(r,null,{default:u((()=>[c("+7")])),_:1})])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),i(f,{required:"",label:m(j)("login.password"),name:"password"},{default:u((()=>[i(o,{type:B.value?"text":"password",modelValue:S.password,"onUpdate:modelValue":a[1]||(a[1]=e=>S.password=e),placeholder:m(j)("login.password.input"),styles:{borderRadius:"12rpx",backgroundColor:"#F8F8F8"},class:"input-field"},null,8,["type","modelValue","placeholder"])])),_:1},8,["label"]),i(f,{required:"",label:m(j)("register.confirmPassword"),name:"rePassword"},{default:u((()=>[i(o,{type:I.value?"text":"password",modelValue:S.rePassword,"onUpdate:modelValue":a[2]||(a[2]=e=>S.rePassword=e),placeholder:m(j)("login.password.input"),styles:{borderRadius:"12rpx",backgroundColor:"#F8F8F8"},class:"input-field"},null,8,["type","modelValue","placeholder"])])),_:1},8,["label"]),S.password?(t(),n(s,{key:0,class:"password-strength-container"},{default:u((()=>[i(r,{class:"strength-label"},{default:u((()=>[c(p(m(j)("user.passwordStrength"))+": "+p(Z.value),1)])),_:1}),i(s,{class:"strength-meter"},{default:u((()=>[i(s,{class:"strength-bar",style:h({width:33.3*W.value+"%",backgroundColor:D.value})},null,8,["style"])])),_:1})])),_:1})):g("",!0),i(f,{required:"",label:m(j)("login.verification.code"),name:"captcha"},{default:u((()=>[i(o,{type:"text",modelValue:S.captcha,"onUpdate:modelValue":a[3]||(a[3]=e=>S.captcha=e),placeholder:m(j)("login.verification.input"),styles:{borderRadius:"12rpx",backgroundColor:"#F8F8F8"},class:"input-field"},{right:u((()=>[i(v,{class:b(["captcha-button",{"captcha-disabled":U.value}]),loading:U.value,disabled:U.value,onClick:J},{default:u((()=>[c(p(U.value?`${z.value}s`:m(j)("register.sendCode")),1)])),_:1},8,["class","loading","disabled"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),i(s,{class:"button-group"},{default:u((()=>[i(v,{class:"cancel-button","hover-class":"button-hover",onClick:$},{default:u((()=>[c(p(m(j)("uni.picker.cancel")),1)])),_:1}),i(v,{class:b(["confirm-button",{"button-disabled":!E.value||A.value}]),disabled:!E.value||A.value,"hover-class":"button-hover",onClick:T},{default:u((()=>[i(s,{class:"button-content"},{default:u((()=>[A.value?(t(),n(L,{key:0,type:"spinner-cycle",size:"18",color:"#FFFFFF"})):g("",!0),i(r,null,{default:u((()=>[c(p(m(j)("user.confirm")),1)])),_:1})])),_:1})])),_:1},8,["disabled","class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-a0a8a435"]]);export{j as default};
