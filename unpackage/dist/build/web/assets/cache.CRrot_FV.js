import{_ as e,$ as t,a0 as r}from"./index-CoyfKnWG.js";const a="LOGIN_STATUS_TOKEN",h="USER_INFO";const i=new class{constructor(a){this.cacheSetHandler=e,this.cacheGetHandler=t,this.cacheClearHandler=r,this.cacheExpire="UNI-APP-CRMEB:TAG",this.clearOverdue()}time(){return Date.now()}strTotime(e){let t=e.substring(0,19);return t=t.replace(/-/g,"/"),Math.round(new Date(t).getTime()/1e3)}setExpireCaheTag(e,t){if("number"==typeof t){let r=this.cacheGetHandler(this.cacheExpire),a=[],h=[];"object"==typeof r&&Array.isArray(r)&&(a=r.map((r=>(h.push(r.key),r.key===e&&(r.expire=t),r)))),h.length&&-1!==h.indexOf(e)||a.push({key:e,expire:t}),this.cacheSetHandler(this.cacheExpire,a)}}getExpireCahe(e,t){try{let r=this.cacheGetHandler(this.cacheExpire),a=0,h=!1;if("object"==typeof r&&r.length){if(r.map(((t,r)=>{t.key===e&&(a=t.expire,h=r)})),a){let i=parseInt(a);return!(a&&a<this.time()&&!Number.isNaN(i))||(void 0!==t&&!0!==t||(this.cacheClearHandler(e),!1!==h&&(r.splice(h,1),this.cacheSetHandler(this.cacheExpire,r))),!1)}return!!this.cacheGetHandler(e)}return!1}catch(r){return!1}}set(e,t,r){if(void 0===t)return!0;try{return this.setExpireCaheTag(e,r),this.cacheSetHandler(e,t)}catch(a){return!1}}has(e,t){return this.clearOverdue(),this.getExpireCahe(e,t)}get(e,t,r){this.clearOverdue();try{let a=this.getExpireCahe(e),h=this.cacheGetHandler(e);if(h&&a)return"boolean"==typeof t?JSON.parse(h):h;if("function"==typeof t){let a=t();return this.set(e,a,r),a}return this.set(e,t,r),t}catch(a){return null}}update(e){const t=this.cacheGetHandler(e);t||(console.warn(`Cache key "${e}" does not exist. Initializing with an empty object.`),this.set(e,{}));const r={get:(e,t)=>e[t],set:(t,r,a)=>(t[r]=a,this.set(e,t),!0)},a="string"==typeof t?JSON.parse(t):t;return new Proxy(a||{},r)}clear(e){try{let t=this.cacheGetHandler(this.cacheExpire),r=!1;return t&&"object"==typeof t&&t.length&&(t.map(((t,a)=>{t.key===e&&(r=a)})),!1!==r&&t.splice(r,1),this.cacheSetHandler(this.cacheExpire,t)),this.cacheClearHandler(e)}catch(t){return!1}}clearOverdue(){let e=this.cacheGetHandler(this.cacheExpire),t=this.time(),r=[],a=[];e&&"object"==typeof e&&e.length&&e.map((e=>{e&&(void 0!==e.expire&&e.expire>t||0===e.expire?a.push(e):r.push(e.key))})),a.length!==e.length&&this.cacheSetHandler(this.cacheExpire,a),r.forEach((e=>{this.cacheClearHandler(e)}))}};export{i as C,a as L,h as U};
