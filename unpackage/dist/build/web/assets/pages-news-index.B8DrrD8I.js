import{u as e,h as a,l as t,o as s,c as l,w as o,m as n,G as r,i,d as u,p as c,t as d,q as m,b as f,e as v,r as w,F as p,n as g,K as h,z as _,x as y,J as F,a as x,s as $}from"./index-CoyfKnWG.js";import{_ as j}from"./uv-load-more.ZTuh-_sz.js";import{b as D,o as k,c as M,r as A}from"./uni-app.es.Df7zo4VE.js";import{_ as b}from"./uni-icons.D0E4Jxnq.js";import{n as C}from"./home.CWEEYXWH.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uv-line.DraL9Iaj.js";import"./mixin.BCR4gqL3.js";import"./uv-loading-icon.CbeM7PMZ.js";import"./request.BIpDWIEA.js";const U=Y({__name:"index",setup(Y){const{t:U,locale:z}=e(),T=a([]),q=a("loadmore"),S=a(1),E=a(10),G=a(!0),H=a(!1),I=a(!1),J=(e=!1)=>{if(!G.value&&!e)return;e&&(S.value=1,T.value=[],G.value=!0,I.value=!0),q.value="loading";const a={page:S.value,pageSize:E.value};C(a).then((a=>{var t;if(0===a.code){const s=(null==(t=a.data)?void 0:t.data)||[];if(0===s.length&&1===S.value)return G.value=!1,void(q.value="nomore");const l=n(),o="zh-Hans"===l?"Zh":l.charAt(0).toUpperCase()+l.slice(1),i=s.map((e=>({id:e.id,title:e[`title${o}`],converUrl:e.coverUrl,createdAt:e.createdAt,views:Math.floor(1e3*Math.random())})));i.length<E.value?(G.value=!1,q.value="nomore"):q.value="loadmore",e?(T.value=i,r({title:U("news.refreshSuccess"),icon:"success",duration:2e3})):T.value=[...T.value,...i],S.value+=1}else G.value=!1,q.value="error",e&&r({title:U("news.refreshFailed"),icon:"error",duration:2e3})})).catch((a=>{console.error(a),q.value="error",e&&r({title:U("news.refreshFailed"),icon:"error",duration:2e3})})).finally((()=>{I.value=!1}))},K=()=>{I.value||J(!0)},N=()=>{h({scrollTop:0,duration:300})},Z=e=>{const a=new Date,t=new Date(e),s=a-t;if(s<864e5&&a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()){if(s<36e5){const e=Math.floor(s/6e4);return e<=0?U("news.justNow"):`${e} ${U("news.minutesAgo")}`}return`${Math.floor(s/36e5)} ${U("news.hoursAgo")}`}const l=new Date(a);if(l.setDate(l.getDate()-1),l.getDate()===t.getDate()&&l.getMonth()===t.getMonth()&&l.getFullYear()===t.getFullYear())return U("news.yesterday");if(s<6048e5){return`${Math.floor(s/864e5)} ${U("news.daysAgo")}`}const o=t.getFullYear(),n=("0"+(t.getMonth()+1)).slice(-2),r=("0"+t.getDate()).slice(-2);return o===a.getFullYear()?`${n}-${r}`:`${o}-${n}-${r}`};return D((({scrollTop:e})=>{H.value=e>300})),k((()=>{J()})),M((()=>{J()})),(e,a)=>{const n=_,r=i,h=y,D=F,k=A(t("uv-load-more"),j),M=A(t("uni-icons"),b);return s(),l(r,{class:"news-container"},{default:o((()=>[u(r,{class:"news-header"},{default:o((()=>[u(n,{class:"news-header-title"},{default:o((()=>[c(d(m(U)("home.news")),1)])),_:1})])),_:1}),u(r,{class:"news-list"},{default:o((()=>[0===T.value.length&&"loading"!==q.value?(s(),l(r,{key:0,class:"empty-state"},{default:o((()=>[u(h,{class:"empty-image",src:"/static/empty-news.png",mode:"aspectFit"}),u(n,{class:"empty-text"},{default:o((()=>[c(d(m(U)("news.empty")),1)])),_:1}),u(D,{class:"refresh-btn",onClick:K},{default:o((()=>[c(d(m(U)("news.refresh")),1)])),_:1})])),_:1})):f("",!0),(s(!0),v(p,null,w(T.value,((e,a)=>(s(),l(r,{key:e.id,class:g(["news-item",{"news-item-highlight":0===a}]),onClick:a=>{return t=e.id,void $({url:"/pages/news/components/details?id="+t,animationType:"slide-in-right"});var t},style:x({animationDelay:.05*a+"s"})},{default:o((()=>[0===a?(s(),v(p,{key:0},[u(h,{class:"news-featured-image",src:e.converUrl,mode:"aspectFill"},null,8,["src"]),u(r,{class:"news-featured-content"},{default:o((()=>[u(r,{class:"news-label"},{default:o((()=>[c(d(m(U)("news.featured")),1)])),_:1}),u(n,{class:"news-featured-title"},{default:o((()=>[c(d(e.title),1)])),_:2},1024),u(r,{class:"news-meta"},{default:o((()=>[u(n,{class:"news-time"},{default:o((()=>[c(d(Z(e.createdAt)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)],64)):(s(),l(r,{key:1,class:"news-content"},{default:o((()=>[u(r,{class:"news-image-container"},{default:o((()=>[u(h,{class:"news-image",src:e.converUrl,mode:"aspectFill"},null,8,["src"])])),_:2},1024),u(r,{class:"news-info"},{default:o((()=>[u(n,{class:"news-title"},{default:o((()=>[c(d(e.title),1)])),_:2},1024),u(r,{class:"news-footer"},{default:o((()=>[u(n,{class:"news-time"},{default:o((()=>[c(d(Z(e.createdAt)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024))])),_:2},1032,["class","onClick","style"])))),128))])),_:1}),u(r,{class:"load-more-wrapper"},{default:o((()=>[u(k,{status:q.value,"loadmore-text":m(U)("news.loadmore"),"loading-text":m(U)("news.loading"),"nomore-text":m(U)("news.nomore"),color:"#8C6E63"},null,8,["status","loadmore-text","loading-text","nomore-text"])])),_:1}),u(r,{class:g(["back-to-top",{visible:H.value}]),onClick:N},{default:o((()=>[u(M,{type:"top",size:"20",color:"#FFFFFF"})])),_:1},8,["class"])])),_:1})}}},[["__scopeId","data-v-68ce2683"]]);export{U as default};
